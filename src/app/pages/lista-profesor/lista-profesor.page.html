<ion-header>
  <!-- Toolbar Verde Institucional -->
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/materias-profesor" color="light"></ion-back-button>
    </ion-buttons>
    <ion-title>Lista de Alumnos</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content>
  <div class="main-container">
    
    <!-- TARJETA DE CLASE (Estilo Borde Azul) -->
    <div class="class-info-card">
      <div class="info-content">
        <h2>{{ grupoNombre }}</h2>
        <p>Materia: <strong>{{ materiaNombre }}</strong></p>
      </div>
      <div class="time-badge">
        <ion-icon name="time-outline"></ion-icon>
        <span>{{ horario }}</span>
      </div>
    </div>

    <!-- TABLA DE ALUMNOS -->
    <div class="table-container">
      <div class="table-header">
        <div class="col-name">ALUMNO</div>
        <div class="col-status">ESTADO SOLICITUD</div>
        <div class="col-actions">ACCIONES</div>
      </div>

      <!-- Filas -->
      <div class="table-row" *ngFor="let alumno of alumnos">
        
        <!-- Columna 1: Datos Alumno + Alerta -->
        <div class="col-name">
          <span class="student-name">{{ alumno.nombre }}</span>
          
          <!-- ALERTA DE RIESGO IA -->
          <div class="risk-alert" *ngIf="alumno.ia_risk > 0"
               [ngClass]="{'risk-high': alumno.ia_risk === 2, 'risk-mod': alumno.ia_risk === 1}">
            <ion-icon name="alert-circle"></ion-icon>
            <span>
              {{ alumno.ia_risk === 2 ? 'ALTO RIESGO' : 'RIESGO MEDIO' }} 
              <span *ngIf="alumno.ia_prob">({{ alumno.ia_prob }}%)</span>
            </span>
          </div>
        </div>

        <!-- Columna 2: Estado -->
        <div class="col-status">
          <span class="status-text" [ngClass]="{
            'pending': alumno.estado === 'Pendiente',
            'none': alumno.estado === 'Sin solicitud' || !alumno.estado
          }">
            {{ (!alumno.estado || alumno.estado === 'Sin solicitud') ? 'SIN SOLICITUD' : alumno.estado.toUpperCase() }}
          </span>
        </div>

        <!-- Columna 3: Acciones -->
        <div class="col-actions">
          
          <!-- Caso 1: Solicitud Pendiente (Siempre habilitado para resolver) -->
          <div class="action-buttons" *ngIf="alumno.estado === 'Pendiente'">
            <button class="btn-icon accept" (click)="aceptarSolicitud(alumno.solicitud_id)" title="Aceptar">
              <ion-icon name="checkmark-outline"></ion-icon>
            </button>
            <button class="btn-icon reject" (click)="rechazarSolicitud(alumno.solicitud_id)" title="Rechazar">
              <ion-icon name="close-outline"></ion-icon>
            </button>
          </div>

          <!-- Caso 2: Sin Solicitud (Requiere Candado de Horario) -->
          <button class="btn-manual" 
                  *ngIf="alumno.estado !== 'Pendiente' && alumno.estado !== 'Aceptada' && alumno.estado !== 'Rechazada'"
                  (click)="registrarAsistenciaManual(alumno)"
                  [disabled]="!dentroHorario"
                  [title]="dentroHorario ? 'Registrar asistencia' : 'Fuera de horario'">
            <!-- Icono Cambia: LÃ¡piz si se puede, Candado si no -->
            <ion-icon [name]="dentroHorario ? 'create-outline' : 'lock-closed'"></ion-icon>
            <span>Registrar Asistencia</span>
          </button>

          <!-- Caso 3: Ya procesado -->
          <span *ngIf="alumno.estado === 'Aceptada' || alumno.estado === 'Rechazada' || alumno.estado === 'Manual'" class="done-badge">
            <ion-icon name="checkmark-outline"></ion-icon> Listo
          </span>

        </div>
      </div>

      <!-- Empty State -->
      <div class="empty-state" *ngIf="alumnos.length === 0">
        <p>No hay alumnos cargados en este grupo.</p>
      </div>

    </div>

  </div>
</ion-content>
<ion-header>
  <ion-toolbar color="success">
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/materias-profesor"></ion-back-button>
    </ion-buttons>
    <ion-title>Lista de Alumnos</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content>
  <div class="main-container">
    
    <!-- Encabezado de la Clase -->
    <div class="class-header">
      <h2>{{ grupoNombre }}</h2>
      <h3>{{ materiaNombre }}</h3>
      <p>{{ horario }}</p>
    </div>

    <!-- Tabla de Asistencia -->
    <div class="table-responsive">
      <table class="attendance-table">
        <thead>
          <tr>
            <th width="35%">Alumno</th>
            <th width="15%" style="text-align: center;">Riesgo IA</th> 
            <th width="20%">Solicitud</th>
            <th width="30%">Acciones</th>
          </tr>
        </thead>
        <tbody>
          
          <tr *ngFor="let alumno of alumnos" [ngClass]="{'risk-high': alumno.ia_risk === 1}">
            
            <!-- Columna 1: Nombre -->
            <td>
              <span class="student-name">{{ alumno.nombre }}</span>
              <span class="student-id">{{ alumno.matricula }}</span>
              
              <!-- Mensaje de IA sutil -->
              <p class="ia-message" *ngIf="alumno.ia_risk === 1" title="{{ alumno.ia_msg }}">
                <ion-icon name="alert-circle-outline"></ion-icon> ALTO RIESGO ({{ alumno.ia_prob }}%)
              </p>
            </td>
            
            <!-- Columna 2: Punto de Riesgo -->
            <td style="text-align: center;">
              <span class="risk-dot" 
                    [ngClass]="{'high': alumno.ia_risk === 1, 'low': alumno.ia_risk === 0}"
                    title="Probabilidad de deserciÃ³n: {{ alumno.ia_prob }}%">
              </span>
            </td>

            <!-- Columna 3: Estado Solicitud -->
            <td>
              <span class="status-badge" [ngClass]="{
                'pending': alumno.estado === 'Pendiente',
                'accepted': alumno.estado === 'Aceptada',
                'rejected': alumno.estado === 'Rechazada',
                'none': alumno.estado !== 'Pendiente' && alumno.estado !== 'Aceptada' && alumno.estado !== 'Rechazada'
              }">
                {{ alumno.estado === 'Sin solicitud' ? '-' : alumno.estado.toUpperCase() }}
              </span>
            </td>

            <!-- Columna 4: Acciones -->
            <td>
              <div class="actions-container">
                
                <!-- Caso: Solicitud Pendiente (Aceptar/Rechazar) -->
                <ng-container *ngIf="alumno.estado === 'Pendiente'">
                  <button class="btn btn-accept" (click)="aceptarSolicitud(alumno.solicitud_id)">
                    <ion-icon name="checkmark-outline"></ion-icon>
                  </button>
                  <button class="btn btn-reject" (click)="rechazarSolicitud(alumno.solicitud_id)">
                    <ion-icon name="close-outline"></ion-icon>
                  </button>
                </ng-container>

                <!-- Caso: Sin Solicitud o Atendida (Registrar Manual) -->
                <ng-container *ngIf="alumno.estado !== 'Pendiente'">
                  <button class="btn btn-manual" (click)="registrarAsistenciaManual(alumno)">Manual</button>
                </ng-container>

              </div>
            </td>
          </tr>

          <tr *ngIf="alumnos.length === 0">
            <td colspan="4" style="text-align:center; padding: 2rem; color: #666;">
              Cargando alumnos o no hay inscritos.
            </td>
          </tr>

        </tbody>
      </table>
    </div>
  </div>
</ion-content>
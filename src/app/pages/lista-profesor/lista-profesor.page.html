<ion-header>
  <ion-toolbar >
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/materias-profesor"></ion-back-button>
    </ion-buttons>
    <ion-title>Lista de Alumnos</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content>
  <div class="main-container">
    
    <!-- Encabezado de la Clase -->
    <div class="class-header">
      <h2>{{ grupoNombre }}</h2>
      <h3>{{ materiaNombre }}</h3>
      <p>{{ horario }}</p>
    </div>

    <!-- Tabla de Asistencia -->
    <div class="table-responsive">
      <table class="attendance-table">
        <thead>
          <tr>
            <th width="40%">ALUMNO</th>
            <th width="25%">ESTADO SOLICITUD</th>
            <th width="35%">ACCIONES</th>
          </tr>
        </thead>
        <tbody>
          
          <tr *ngFor="let alumno of alumnos">
            
            <!-- Columna 1: Alumno + Info Riesgo -->
            <td>
              <div class="student-info">
                <span class="student-name">{{ alumno.nombre }}</span>
                <span class="student-id">{{ alumno.matricula }}</span>
                
                <!-- Alerta de Riesgo (Si aplica) -->
                <div class="ia-message" *ngIf="alumno.ia_risk === 1">
                  <ion-icon name="alert-circle-outline"></ion-icon> 
                  ALTO RIESGO ({{ alumno.ia_prob }}%)
                </div>
              </div>
            </td>

            <!-- Columna 2: Estado Solicitud -->
            <td style="text-align: left;">
              <span class="status-badge" [ngClass]="{
                'pending': alumno.estado === 'Pendiente',
                'accepted': alumno.estado === 'Aceptada',
                'rejected': alumno.estado === 'Rechazada',
                'none': alumno.estado !== 'Pendiente' && alumno.estado !== 'Aceptada' && alumno.estado !== 'Rechazada'
              }">
                {{ alumno.estado === 'Sin solicitud' ? 'Sin solicitud' : alumno.estado }}
              </span>
            </td>

            <!-- Columna 3: Acciones -->
            <td>
              <div class="actions-container">
                
                <!-- Caso: Solicitud Pendiente (Aceptar/Rechazar) -->
                <ng-container *ngIf="alumno.estado === 'Pendiente'">
                  <button class="btn btn-accept" (click)="aceptarSolicitud(alumno.solicitud_id)" title="Aceptar">
                    <ion-icon name="checkmark-outline"></ion-icon>
                  </button>
                  <button class="btn btn-reject" (click)="rechazarSolicitud(alumno.solicitud_id)" title="Rechazar">
                    <ion-icon name="close-outline"></ion-icon>
                  </button>
                </ng-container>

                <!-- Caso: Sin Solicitud o Ya Procesada -->
                <ng-container *ngIf="alumno.estado !== 'Pendiente'">
                  <button class="btn btn-manual" (click)="registrarAsistenciaManual(alumno)">
                    Registrar Asistencia
                  </button>
                </ng-container>

              </div>
            </td>
          </tr>

          <!-- Mensaje VacÃ­o -->
          <tr *ngIf="alumnos.length === 0">
            <td colspan="3" style="text-align:center; padding: 2rem; color: #777;">
              Cargando alumnos o no hay inscritos en este grupo.
            </td>
          </tr>

        </tbody>
      </table>
    </div>
  </div>
</ion-content>
<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-title> {{ nombreCompleto }}  {{ grupoNombre }}</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  <ion-header collapse="condense">
    <ion-toolbar>
      <ion-title size="large">{{ nombreCompleto }}</ion-title>
    </ion-toolbar>
  </ion-header>

  <!-- 1. MATERIAS -->
  <ion-grid>
    <ion-row><ion-col size="12"><h2>Materias</h2></ion-col></ion-row>
    <ion-row *ngFor="let materia of materias">
      <ion-col size="12">
        <ion-card>
          <ion-card-header>
            <ion-card-title>{{ materia.nombre_materia }}</ion-card-title>
            <ion-card-subtitle>{{ materia.dia_semana }} {{ materia.hora_inicio }} - {{ materia.hora_fin }}</ion-card-subtitle>
          </ion-card-header>
          <ion-card-content>
            <p *ngIf="materia.estado_solicitud === 'Rechazada' && materia.observaciones">
              <strong>Motivo:</strong> {{ materia.observaciones }}
            </p>
            <ion-button class="custom-asistencia-btn" color="" expand="block"
              *ngIf="!materia.estado_solicitud && materia.puede_solicitar"
              (click)="enviarSolicitud(materia.clase_id)">
              Enviar solicitud de asistencia
            </ion-button>
            <ion-note color="warning" *ngIf="!materia.estado_solicitud && !materia.puede_solicitar">
              Solo puedes solicitar asistencia el {{ materia.dia_semana }} entre {{ materia.hora_inicio }} y {{ materia.hora_fin }}
            </ion-note>
            <ion-note color="success" *ngIf="materia.estado_solicitud === 'Pendiente'">Solicitud enviada.</ion-note>
            <ion-note color="danger" *ngIf="materia.estado_solicitud === 'Rechazada' && !materia.observaciones">Solicitud rechazada.</ion-note>
            <ion-note color="primary" *ngIf="materia.estado_solicitud === 'Aceptada'">Solicitud aceptada.</ion-note>
          </ion-card-content>
        </ion-card>
      </ion-col>
    </ion-row>
  </ion-grid>

  <!-- 2. RESUMEN ACADÉMICO (NUEVO) -->
  <ion-grid *ngIf="promedioGeneral !== null">
    <ion-row><ion-col size="12"><h2>Resumen Académico</h2></ion-col></ion-row>
    <ion-row>
      <ion-col size="12">
        <ion-card class="academic-summary-card">
          <ion-grid>
            <ion-row class="ion-align-items-center">
              <ion-col size="5" class="ion-text-center">
                <div class="progress-circle">
                  <span class="progress-number">{{ promedioGeneral | number:'1.1-1' }}</span>
                </div>
                <div class="progress-label">Promedio</div>
              </ion-col>
              <ion-col size="7">
                <div class="highlight-card best" *ngIf="materiaSobresaliente">
                  <ion-icon name="star"></ion-icon>
                  <div class="highlight-text">
                    <p>Mejor Materia</p>
                    <strong>{{ materiaSobresaliente.nombre }}</strong>
                    <span>{{ materiaSobresaliente.calificacion }}</span>
                  </div>
                </div>
                <div class="highlight-card worst" *ngIf="materiaMejorar">
                  <ion-icon name="warning"></ion-icon>
                  <div class="highlight-text">
                    <p>A Mejorar</p>
                    <strong>{{ materiaMejorar.nombre }}</strong>
                    <span>{{ materiaMejorar.calificacion }}</span>
                  </div>
                </div>
              </ion-col>
            </ion-row>
          </ion-grid>
        </ion-card>
      </ion-col>
    </ion-row>
  </ion-grid>

  <!-- 3. ASISTENCIAS -->
  <ion-grid>
    <ion-row><ion-col size="12"><h2>Resumen de Asistencias</h2></ion-col></ion-row>
    <ion-row *ngIf="asistenciasResumen.length === 0">
      <ion-col size="12"><p class="empty-message">No hay historial.</p></ion-col>
    </ion-row>
    <ion-row *ngFor="let asistencia of asistenciasResumen">
      <ion-col size="12">
        <ion-card>
          <ion-card-header>
            <ion-card-title>{{ asistencia.materia }}</ion-card-title>
          </ion-card-header>
          <ion-card-content>
            <div class="summary-item"><span class="summary-label">Asistencias:</span><span class="summary-value">{{ asistencia.asistencias }}</span></div>
            <div class="summary-item"><span class="summary-label">Faltas justif.:</span><span class="summary-value">{{ asistencia.faltas_justificadas }}</span></div>
            <div class="summary-item"><span class="summary-label">Faltas injustif.:</span><span class="summary-value value-danger">{{ asistencia.faltas_injustificadas }}</span></div>
          </ion-card-content>
        </ion-card>
      </ion-col>
    </ion-row>
  </ion-grid>
</ion-content>
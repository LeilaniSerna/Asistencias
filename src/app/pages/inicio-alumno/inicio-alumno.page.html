<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-title> {{ nombreCompleto }}  {{ grupoNombre }}</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  <ion-header collapse="condense">
    <ion-toolbar>
      <ion-title size="large">{{ nombreCompleto }}</ion-title>
    </ion-toolbar>
  </ion-header>

  <!-- === SECCIÓN 1: MATERIAS (Solicitud) === -->
  <ion-grid>
    <ion-row>
      <ion-col size="12">
        <h2>Materias</h2>
      </ion-col>
    </ion-row>

    <ion-row *ngFor="let materia of materias">
      <ion-col size="12">
        <ion-card>
          <ion-card-header>
            <ion-card-title>{{ materia.nombre_materia }}</ion-card-title>
            <ion-card-subtitle>{{ materia.dia_semana }} {{ materia.hora_inicio }} - {{ materia.hora_fin }}</ion-card-subtitle>
          </ion-card-header>

          <ion-card-content>
            <p *ngIf="materia.estado_solicitud === 'Rechazada' && materia.observaciones">
              <strong>Motivo:</strong> {{ materia.observaciones }}
            </p>

            <ion-button
              class="custom-asistencia-btn"
              color=""
              expand="block"
              *ngIf="!materia.estado_solicitud && materia.puede_solicitar"
              (click)="enviarSolicitud(materia.clase_id)">
              Enviar solicitud de asistencia
            </ion-button>

            <ion-note color="warning" *ngIf="!materia.estado_solicitud && !materia.puede_solicitar">
              Solo puedes solicitar asistencia el {{ materia.dia_semana }} entre {{ materia.hora_inicio }} y {{ materia.hora_fin }}
            </ion-note>

            <ion-note color="success" *ngIf="materia.estado_solicitud === 'Pendiente'">
              Solicitud ya enviada, esperando respuesta del profesor.
            </ion-note>

            <ion-note color="danger" *ngIf="materia.estado_solicitud === 'Rechazada' && !materia.observaciones">
              Solicitud rechazada.
            </ion-note>

            <ion-note color="primary" *ngIf="materia.estado_solicitud === 'Aceptada'">
              Solicitud aceptada.
            </ion-note>
          </ion-card-content>
        </ion-card>
      </ion-col>
    </ion-row>
  </ion-grid>

  <!-- === SECCIÓN 2: RESUMEN ACADÉMICO (NUEVO) === -->
  <!-- Solo se muestra si ya se cargó el promedio -->
  <ion-grid *ngIf="promedioGeneral !== null">
    <ion-row>
      <ion-col size="12">
        <h2>Resumen Académico</h2>
      </ion-col>
    </ion-row>

    <ion-row>
      <ion-col size="12">
        <ion-card>
          <ion-card-header>
            <!-- Mostramos el promedio con 1 decimal -->
            <ion-card-title>Promedio General: {{ promedioGeneral | number:'1.1-1' }}</ion-card-title>
          </ion-card-header>
          <ion-card-content>
            
            <!-- Materia Sobresaliente -->
            <div class="summary-item" *ngIf="materiaSobresaliente">
              <div style="display: flex; align-items: center; gap: 8px;">
                <ion-icon name="star" style="color: #9fc34c; font-size: 1.2rem;"></ion-icon>
                <span class="summary-label">Materia Sobresaliente:</span>
              </div>
              <span class="summary-value">
                {{ materiaSobresaliente.nombre }} ({{ materiaSobresaliente.calificacion }})
              </span>
            </div>

            <!-- Materia a Mejorar -->
            <div class="summary-item" *ngIf="materiaMejorar">
              <div style="display: flex; align-items: center; gap: 8px;">
                <ion-icon name="warning" style="color: #ffc409; font-size: 1.2rem;"></ion-icon>
                <span class="summary-label">Materia a Mejorar:</span>
              </div>
              <span class="summary-value">
                {{ materiaMejorar.nombre }} ({{ materiaMejorar.calificacion }})
              </span>
            </div>

          </ion-card-content>
        </ion-card>
      </ion-col>
    </ion-row>
  </ion-grid>

  <!-- === SECCIÓN 3: RESUMEN DE ASISTENCIAS === -->
  <ion-grid>
    <ion-row>
      <ion-col size="12">
        <h2>Resumen de Asistencias</h2>
      </ion-col>
    </ion-row>

    <ion-row *ngIf="asistenciasResumen.length === 0">
      <ion-col size="12">
        <p class="empty-message">No hay historial de asistencias para mostrar.</p>
      </ion-col>
    </ion-row>

    <ion-row *ngFor="let asistencia of asistenciasResumen">
      <ion-col size="12">
        <ion-card>
          <ion-card-header>
            <ion-card-title>{{ asistencia.materia }}</ion-card-title>
          </ion-card-header>
          <ion-card-content>
            <div class="summary-item">
              <span class="summary-label">Asistencias:</span>
              <span class="summary-value">{{ asistencia.asistencias }}</span>
            </div>
            <div class="summary-item">
              <span class="summary-label">Faltas justificadas:</span>
              <span class="summary-value">{{ asistencia.faltas_justificadas }}</span>
            </div>
            <div class="summary-item">
              <span class="summary-label">Faltas injustificadas:</span>
              <span class="summary-value value-danger">{{ asistencia.faltas_injustificadas }}</span>
            </div>
          </ion-card-content>
        </ion-card>
      </ion-col>
    </ion-row>
  </ion-grid>

</ion-content>
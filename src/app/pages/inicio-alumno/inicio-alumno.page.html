<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-title> {{ nombreCompleto }}  {{ grupoNombre }}</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  <ion-header collapse="condense">
    <ion-toolbar>
      <ion-title size="large">{{ nombreCompleto }}</ion-title>
    </ion-toolbar>
  </ion-header>

  <ion-grid>
    <ion-row>
      <ion-col size="12">
        <h2 style="text-align: center;">Materias</h2>
      </ion-col>
    </ion-row>

    <ion-row *ngFor="let materia of materias">
      <ion-col size="12">
        <ion-card>
          <ion-card-header>
            <ion-card-title>{{ materia.nombre_materia }}</ion-card-title>
            <ion-card-subtitle>{{ materia.dia_semana }} {{ materia.hora_inicio }} - {{ materia.hora_fin }}</ion-card-subtitle>
          </ion-card-header>

          <ion-card-content>
          
            <p *ngIf="materia.estado_solicitud === 'Rechazada' && materia.observaciones">
              <strong>Motivo:</strong> {{ materia.observaciones }}
            </p>

            <!-- ✅ Mostrar botón solo si NO hay estado de solicitud y está en horario -->
            <ion-button
              class="custom-asistencia-btn"
              color=""
              expand="block"
              *ngIf="!materia.estado_solicitud && materia.puede_solicitar"
              (click)="enviarSolicitud(materia.clase_id)">
              Enviar solicitud de asistencia
            </ion-button>

            <!-- ⛔️ Fuera de horario sin solicitud -->
            <ion-note color="warning" *ngIf="!materia.estado_solicitud && !materia.puede_solicitar">
              Solo puedes solicitar asistencia el {{ materia.dia_semana }} entre {{ materia.hora_inicio }} y {{ materia.hora_fin }}
            </ion-note>

            <!-- 🕐 Solicitud enviada -->
            <ion-note color="success" *ngIf="materia.estado_solicitud === 'Pendiente'">
              Solicitud ya enviada, esperando respuesta del profesor.
            </ion-note>

            <!-- ❌ Rechazada sin botón -->
            <ion-note color="danger" *ngIf="materia.estado_solicitud === 'Rechazada' && !materia.observaciones">
              Solicitud rechazada.
            </ion-note>

            <!-- ✅ Aceptada -->
            <ion-note color="primary" *ngIf="materia.estado_solicitud === 'Aceptada'">
              Solicitud aceptada.
            </ion-note>

          </ion-card-content>
        </ion-card>
      </ion-col>
    </ion-row>
  </ion-grid>

  <ion-grid>
    <ion-row>
      <ion-col size="12">
        <h2 style="text-align: center; margin-top: 30px;">Resumen de Asistencias</h2>
      </ion-col>
    </ion-row>

    <ion-row *ngIf="asistenciasResumen.length === 0">
      <ion-col size="12" style="text-align:center;">
        <p>No hay historial de asistencias para mostrar.</p>
      </ion-col>
    </ion-row>

    <ion-row *ngFor="let asistencia of asistenciasResumen">
      <ion-col size="12">
        <ion-card>
          <ion-card-header>
            <ion-card-title>{{ asistencia.materia }}</ion-card-title>
          </ion-card-header>
          <ion-card-content>
            <p><strong>Asistencias:</strong> {{ asistencia.asistencias }}</p>
            <p><strong>Faltas justificadas:</strong> {{ asistencia.faltas_justificadas }}</p>
            <p><strong>Faltas injustificadas:</strong> {{ asistencia.faltas_injustificadas }}</p>
          </ion-card-content>
        </ion-card>
      </ion-col>
    </ion-row>
  </ion-grid>
</ion-content>

import{b as Q}from"./chunk-33XRR7PD.js";import{A as L,B as V,C as B,D as J,I as W,J as Y,M as q,N as K,a as D,b as N,c as F,f as R,r as k,u as z,v as G,w as O,x as U,y as j,z as H}from"./chunk-52UE2MJF.js";import"./chunk-G5DBTQCY.js";import{Ba as P,Fa as x,Ma as d,Oa as c,Pa as o,Ta as $,Ua as T,Va as _,Z as E,_ as C,ab as n,bb as I,cb as f,db as M,eb as b,sa as a,xa as A}from"./chunk-QI2UKG4A.js";import"./chunk-4G7SAIE5.js";import"./chunk-LRSHVU3G.js";import"./chunk-473DEPGT.js";import"./chunk-CKIBZVXW.js";import"./chunk-PS2NURIG.js";import"./chunk-4U6PRYVA.js";import"./chunk-FXFZIWDD.js";import"./chunk-CSG5OQLY.js";import"./chunk-VMHM3MLJ.js";import"./chunk-6MDLUQIX.js";import"./chunk-C5RQ2IC2.js";import"./chunk-42C7ZIID.js";import{a as S,b as y,f as h}from"./chunk-RW4GY4BD.js";function ee(e){e.CapacitorUtils.Synapse=new Proxy({},{get(r,t){return new Proxy({},{get(s,i){return(l,g,u)=>{let m=e.Capacitor.Plugins[t];if(m===void 0){u(new Error(`Capacitor plugin ${t} not found`));return}if(typeof m[i]!="function"){u(new Error(`Method ${i} not found in Capacitor plugin ${t}`));return}h(null,null,function*(){try{let p=yield m[i](l);g(p)}catch(p){u(p)}})}}})}})}function te(e){e.CapacitorUtils.Synapse=new Proxy({},{get(r,t){return e.cordova.plugins[t]}})}function X(e=!1){typeof window>"u"||(window.CapacitorUtils=window.CapacitorUtils||{},window.Capacitor!==void 0&&!e?ee(window):window.cordova!==void 0&&te(window))}var Z=Q("Geolocation",{web:()=>import("./chunk-DR2HBSBP.js").then(e=>new e.GeolocationWeb)});X();function ie(e,r){if(e&1&&(c(0,"p")(1,"strong"),n(2,"Estado de solicitud:"),o(),n(3),o()),e&2){let t=_().$implicit;a(3),f(" ",t.estado_solicitud," ")}}function oe(e,r){if(e&1&&(c(0,"p")(1,"strong"),n(2,"Motivo:"),o(),n(3),o()),e&2){let t=_().$implicit;a(3),f(" ",t.observaciones," ")}}function ne(e,r){if(e&1){let t=$();c(0,"ion-button",14),T("click",function(){E(t);let i=_().$implicit,l=_();return C(l.enviarSolicitud(i.clase_id))}),n(1," Enviar solicitud de asistencia "),o()}}function ae(e,r){if(e&1&&(c(0,"ion-note",15),n(1),o()),e&2){let t=_().$implicit;a(),b(" Solo puedes solicitar asistencia el ",t.dia_semana," entre ",t.hora_inicio," y ",t.hora_fin," ")}}function re(e,r){e&1&&(c(0,"ion-note",16),n(1," Solicitud ya enviada, esperando respuesta del profesor. "),o())}function se(e,r){e&1&&(c(0,"ion-note",17),n(1," Solicitud rechazada. "),o())}function ce(e,r){e&1&&(c(0,"ion-note",18),n(1," Solicitud aceptada. "),o())}function le(e,r){if(e&1&&(c(0,"ion-row")(1,"ion-col",4)(2,"ion-card")(3,"ion-card-header")(4,"ion-card-title"),n(5),o(),c(6,"ion-card-subtitle"),n(7),o()(),c(8,"ion-card-content"),x(9,ie,4,1,"p",8)(10,oe,4,1,"p",8)(11,ne,2,0,"ion-button",9)(12,ae,2,3,"ion-note",10)(13,re,2,0,"ion-note",11)(14,se,2,0,"ion-note",12)(15,ce,2,0,"ion-note",13),o()()()()),e&2){let t=r.$implicit;a(5),I(t.nombre_materia),a(2),b("",t.dia_semana," ",t.hora_inicio," - ",t.hora_fin,""),a(2),d("ngIf",t.estado_solicitud),a(),d("ngIf",t.estado_solicitud==="Rechazada"&&t.observaciones),a(),d("ngIf",!t.estado_solicitud&&t.puede_solicitar),a(),d("ngIf",!t.estado_solicitud&&!t.puede_solicitar),a(),d("ngIf",t.estado_solicitud==="Pendiente"),a(),d("ngIf",t.estado_solicitud==="Rechazada"&&!t.observaciones),a(),d("ngIf",t.estado_solicitud==="Aceptada")}}function de(e,r){e&1&&(c(0,"ion-row")(1,"ion-col",19)(2,"p"),n(3,"No hay historial de asistencias para mostrar."),o()()())}function me(e,r){if(e&1&&(c(0,"ion-row")(1,"ion-col",4)(2,"ion-card")(3,"ion-card-header")(4,"ion-card-title"),n(5),o()(),c(6,"ion-card-content")(7,"p")(8,"strong"),n(9,"Asistencias:"),o(),n(10),o(),c(11,"p")(12,"strong"),n(13,"Faltas justificadas:"),o(),n(14),o(),c(15,"p")(16,"strong"),n(17,"Faltas injustificadas:"),o(),n(18),o()()()()()),e&2){let t=r.$implicit;a(5),I(t.materia),a(5),f(" ",t.asistencias,""),a(4),f(" ",t.faltas_justificadas,""),a(4),f(" ",t.faltas_injustificadas,"")}}var Ee=(()=>{let r=class r{constructor(s){this.http=s,this.alumnoId=0,this.nombreCompleto="",this.grupoNombre="",this.materias=[],this.asistenciasResumen=[]}ngOnInit(){let i=JSON.parse(localStorage.getItem("user")||"{}").id;i&&this.obtenerAlumnoIdPorUsuario(i)}obtenerAlumnoIdPorUsuario(s){this.http.get(`http://192.168.0.103:5000/usuario/${s}/alumno-id`).subscribe({next:i=>{this.alumnoId=i.alumno_id,this.obtenerDatosAlumno(this.alumnoId)},error:i=>{console.error("Error al obtener alumnoId:",i),alert("No se pudo obtener el ID del alumno.")}})}obtenerDatosAlumno(s){this.http.get(`http://192.168.0.103:5000/alumno/${s}/info`).subscribe(i=>{this.nombreCompleto=`${i.nombre} ${i.apellido}`,this.grupoNombre=i.grupo,this.obtenerMaterias(s),this.obtenerResumenAsistencias(s)})}obtenerMaterias(s){this.http.get(`http://192.168.0.103:5000/alumno/${s}/materias`).subscribe(i=>{let l=new Date,g=this.obtenerDiaSemana(l.getDay()),u=l.toTimeString().slice(0,5);this.materias=i.map(m=>{let p=m.dia_semana===g&&u>=m.hora_inicio&&u<=m.hora_fin;return y(S({},m),{puede_solicitar:p})})})}obtenerResumenAsistencias(s){this.http.get(`http://192.168.0.103:5000/alumno/${s}/asistencias-resumen`).subscribe({next:i=>{this.asistenciasResumen=i},error:i=>{console.error("Error al obtener resumen de asistencias:",i)}})}obtenerDiaSemana(s){return["Domingo","Lunes","Martes","Mi\xE9rcoles","Jueves","Viernes","S\xE1bado"][s]}enviarSolicitud(s){return h(this,null,function*(){try{let i=new Date,l=`${i.getFullYear()}-${String(i.getMonth()+1).padStart(2,"0")}-${String(i.getDate()).padStart(2,"0")}`,g=i.toTimeString().slice(0,8),u=yield Z.getCurrentPosition(),m={alumno_id:this.alumnoId,clase_id:s,fecha:l,hora:g,latitud_usuario:u.coords.latitude,longitud_usuario:u.coords.longitude};this.http.post("http://192.168.0.103:5000/alumno/enviar-solicitud",m).subscribe(p=>{alert("Solicitud enviada correctamente"),this.obtenerMaterias(this.alumnoId)},p=>{var v;let w=((v=p.error)==null?void 0:v.error)||"Error desconocido al enviar solicitud";alert("No se pudo enviar la solicitud: "+w),w.toLowerCase().includes("pendiente")&&this.obtenerMaterias(this.alumnoId)})}catch(i){console.error("Error al obtener ubicaci\xF3n:",i),alert("No se pudo obtener la ubicaci\xF3n. Activa el GPS e int\xE9ntalo de nuevo.")}})}};r.\u0275fac=function(i){return new(i||r)(A(R))},r.\u0275cmp=P({type:r,selectors:[["app-inicio-alumno"]],decls:22,vars:8,consts:[[3,"translucent"],[3,"fullscreen"],["collapse","condense"],["size","large"],["size","12"],[2,"text-align","center"],[4,"ngFor","ngForOf"],[2,"text-align","center","margin-top","30px"],[4,"ngIf"],["color","primary","expand","block",3,"click",4,"ngIf"],["color","warning",4,"ngIf"],["color","success",4,"ngIf"],["color","danger",4,"ngIf"],["color","primary",4,"ngIf"],["color","primary","expand","block",3,"click"],["color","warning"],["color","success"],["color","danger"],["color","primary"],["size","12",2,"text-align","center"]],template:function(i,l){i&1&&(c(0,"ion-header",0)(1,"ion-toolbar")(2,"ion-title"),n(3),o()()(),c(4,"ion-content",1)(5,"ion-header",2)(6,"ion-toolbar")(7,"ion-title",3),n(8),o()()(),c(9,"ion-grid")(10,"ion-row")(11,"ion-col",4)(12,"h2",5),n(13,"Materias"),o()()(),x(14,le,16,11,"ion-row",6),o(),c(15,"ion-grid")(16,"ion-row")(17,"ion-col",4)(18,"h2",7),n(19,"Resumen de Asistencias"),o()()(),x(20,de,4,0,"ion-row",8)(21,me,19,4,"ion-row",6),o()()),i&2&&(d("translucent",!0),a(3),M("Bienvenido: ",l.nombreCompleto," (",l.grupoNombre,")"),a(),d("fullscreen",!0),a(4),I(l.nombreCompleto),a(6),d("ngForOf",l.materias),a(6),d("ngIf",l.asistenciasResumen.length===0),a(),d("ngForOf",l.asistenciasResumen))},dependencies:[j,V,J,q,K,F,D,N,k,B,Y,L,z,G,U,H,O,W],encapsulation:2});let e=r;return e})();export{Ee as InicioAlumnoPage};

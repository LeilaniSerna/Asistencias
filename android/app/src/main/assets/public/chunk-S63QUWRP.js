import{a as Y}from"./chunk-YCXH5CB5.js";import{A as B,B as J,C as q,D as G,J as U,L as K,M as Q,N as W,P as X,a as L,b as O,c as V,f as $,i as j,r as D,u as R}from"./chunk-52UE2MJF.js";import"./chunk-G5DBTQCY.js";import{$a as F,Ba as H,Fa as w,Ma as u,N as P,Oa as s,Pa as a,Ra as M,S as N,Sa as z,Ta as E,Ua as A,Va as m,Z as I,_ as v,ab as c,bb as k,cb as g,jb as T,sa as l,xa as h}from"./chunk-QI2UKG4A.js";import"./chunk-4G7SAIE5.js";import"./chunk-LRSHVU3G.js";import"./chunk-473DEPGT.js";import"./chunk-CKIBZVXW.js";import"./chunk-PS2NURIG.js";import"./chunk-4U6PRYVA.js";import"./chunk-FXFZIWDD.js";import"./chunk-CSG5OQLY.js";import"./chunk-VMHM3MLJ.js";import"./chunk-6MDLUQIX.js";import"./chunk-C5RQ2IC2.js";import"./chunk-42C7ZIID.js";import{a as C,b as y,f as S}from"./chunk-RW4GY4BD.js";var Z=(()=>{let r=class r{constructor(t){this.http=t,this.apiUrl="http://localhost:5000"}verificarFaltas(t,e,i){let d={profesor_id:t,grupo_id:e,materia_id:i};return this.http.post(`${this.apiUrl}/profesor/verificar-faltas`,d)}};r.\u0275fac=function(e){return new(e||r)(N($))},r.\u0275prov=P({token:r,factory:r.\u0275fac,providedIn:"root"});let o=r;return o})();function lt(o,r){if(o&1){let n=E();s(0,"ion-button",10),A("click",function(){I(n);let e=m(2).$implicit,i=m();return v(i.aceptarSolicitud(e.solicitud_id))}),c(1," Aceptar "),a()}if(o&2){let n=m(2).$implicit;u("disabled",n.estado!=="Pendiente")}}function mt(o,r){if(o&1){let n=E();s(0,"ion-button",11),A("click",function(){I(n);let e=m(2).$implicit,i=m();return v(i.rechazarSolicitud(e.solicitud_id))}),c(1," Rechazar "),a()}if(o&2){let n=m(2).$implicit;u("disabled",n.estado!=="Pendiente")}}function dt(o,r){if(o&1){let n=E();s(0,"ion-button",12),A("click",function(){I(n);let e=m(2).$implicit,i=m();return v(i.registrarAsistenciaManual(e))}),c(1," Registrar asistencia manual "),a()}}function ut(o,r){if(o&1&&(M(0),w(1,lt,2,1,"ion-button",7)(2,mt,2,1,"ion-button",8)(3,dt,2,0,"ion-button",9),z()),o&2){let n=m().$implicit,t=m();l(),u("ngIf",n.estado!=="Sin solicitud"),l(),u("ngIf",n.estado!=="Sin solicitud"),l(),u("ngIf",t.mostrarBotonAsistenciaManual(n))}}function pt(o,r){o&1&&(s(0,"ion-text",13),c(1," Fuera del horario de la materia "),a())}function _t(o,r){if(o&1&&(s(0,"ion-row")(1,"ion-col"),c(2),a(),s(3,"ion-col"),c(4),a(),s(5,"ion-col"),w(6,ut,4,3,"ng-container",6)(7,pt,2,0,"ng-template",null,0,T),a()()),o&2){let n=r.$implicit,t=F(8),e=m();l(2),k(n.nombre),l(2),g("Asistencia: ",n.estado,""),l(2),u("ngIf",e.dentroHorario)("ngIfElse",t)}}var wt=(()=>{let r=class r{constructor(t,e,i,d){this.route=t,this.alumnosService=e,this.asistenciasProfesorService=i,this.alertController=d,this.grupoId=null,this.grupoNombre="",this.materiaId=null,this.materiaNombre="",this.horario="",this.alumnos=[],this.dentroHorario=!1}ngOnInit(){let t=this.route.snapshot.queryParamMap;this.grupoId=Number(t.get("grupoId")),this.grupoNombre=t.get("grupoNombre")||"",this.materiaNombre=t.get("materiaNombre")||"",this.materiaId=Number(t.get("materiaId")),this.horario=t.get("horario")||"",this.verificarHorario(),this.cargarSolicitudes(),this.verificarFaltasAutomaticas()}verificarHorario(){let t={Domingo:0,Lunes:1,Martes:2,Mi\u00E9rcoles:3,Jueves:4,Viernes:5,S\u00E1bado:6},e=this.horario.split(" "),i=e[0],d=e.slice(1).join(" ").split("-"),_=d[0].trim(),p=d[1].trim(),f=new Date,x=f.getDay(),b=f.getHours()+f.getMinutes()/60;if(x!==t[i]){this.dentroHorario=!1,console.log(`\u26A0\uFE0F Hoy no es ${i}, es ${Object.keys(t).find(nt=>t[nt]===x)}`);return}let[tt,et]=_.split(":").map(Number),[it,ot]=p.split(":").map(Number),rt=tt+et/60,at=it+ot/60;this.dentroHorario=b>=rt&&b<=at,console.log("\u23F0 Horario verificado. Dentro del horario:",this.dentroHorario)}cargarSolicitudes(){this.grupoId&&this.materiaNombre&&this.alumnosService.obtenerSolicitudesPorClase(this.grupoId,this.materiaNombre,this.horario).subscribe({next:t=>{console.log("Solicitudes cargadas:",t),this.alumnos=t.map(e=>y(C({},e),{dentroHorario:this.dentroHorario}))},error:t=>{console.error("\u274C Error al obtener alumnos:",t),this.mostrarAlerta("Error","Hubo un problema al cargar las solicitudes.")}})}verificarFaltasAutomaticas(){let e=JSON.parse(localStorage.getItem("user")||"{}").id;this.grupoId&&this.materiaId&&this.asistenciasProfesorService.verificarFaltas(e,this.grupoId,this.materiaId).subscribe({next:i=>{console.log("\u2705 Faltas verificadas autom\xE1ticamente:",i)},error:i=>{console.error("\u274C Error al verificar faltas autom\xE1ticas:",i)}})}aceptarSolicitud(t){let i=JSON.parse(localStorage.getItem("user")||"{}").id;this.alumnosService.responderSolicitud({solicitud_id:t,profesor_id:i,estado:"Aceptada"}).subscribe({next:()=>{this.mostrarAlerta("\xC9xito","Solicitud aceptada correctamente."),this.cargarSolicitudes()},error:d=>{console.error("\u274C Error al aceptar solicitud:",d),this.mostrarAlerta("Error","No se pudo aceptar la solicitud.")}})}rechazarSolicitud(t){return S(this,null,function*(){yield(yield this.alertController.create({header:"Motivo de rechazo",inputs:[{name:"motivo",type:"text",placeholder:"Escribe el motivo..."}],buttons:[{text:"Cancelar",role:"cancel"},{text:"Enviar",handler:i=>{let _=JSON.parse(localStorage.getItem("user")||"{}").id;this.alumnosService.responderSolicitud({solicitud_id:t,profesor_id:_,estado:"Rechazada",observaciones:i.motivo||null}).subscribe({next:()=>{this.mostrarAlerta("\xC9xito","Solicitud rechazada correctamente."),this.cargarSolicitudes()},error:p=>{console.error("Error al rechazar solicitud:",p),this.mostrarAlerta("Error","No se pudo rechazar la solicitud.")}})}}]})).present()})}mostrarBotonAsistenciaManual(t){return this.dentroHorario?!["Aceptada","Rechazada","Enviada","Manual"].includes(t.estado):!1}registrarAsistenciaManual(t){return S(this,null,function*(){yield(yield this.alertController.create({header:"Registrar asistencia manual",inputs:[{name:"motivo",type:"text",placeholder:"Motivo por el cual el alumno no pudo enviar solicitud"}],buttons:[{text:"Cancelar",role:"cancel"},{text:"Registrar",handler:i=>{let _=JSON.parse(localStorage.getItem("user")||"{}").id,p=new Date,f=p.toISOString().slice(0,10),x=p.toTimeString().slice(0,8);this.alumnosService.registrarAsistenciaManual({alumno_id:t.alumno_id,clase_id:t.clase_id,profesor_id:_,fecha:f,hora:x,motivo:i.motivo}).subscribe({next:()=>{this.mostrarAlerta("\xC9xito","Asistencia manual registrada correctamente."),this.cargarSolicitudes()},error:b=>{console.error("Error al registrar asistencia manual:",b),this.mostrarAlerta("Error","No se pudo registrar la asistencia manual.")}})}}]})).present()})}mostrarAlerta(t,e){return S(this,null,function*(){yield(yield this.alertController.create({header:t,message:e,buttons:["OK"]})).present()})}};r.\u0275fac=function(e){return new(e||r)(h(j),h(Y),h(Z),h(X))},r.\u0275cmp=H({type:r,selectors:[["app-lista-profesor"]],decls:27,vars:6,consts:[["fueraHorario",""],[3,"translucent"],[1,"ion-padding",3,"fullscreen"],["collapse","condense"],["size","large"],[4,"ngFor","ngForOf"],[4,"ngIf","ngIfElse"],["color","success","size","small",3,"disabled","click",4,"ngIf"],["color","danger","size","small",3,"disabled","click",4,"ngIf"],["color","tertiary","size","small",3,"click",4,"ngIf"],["color","success","size","small",3,"click","disabled"],["color","danger","size","small",3,"click","disabled"],["color","tertiary","size","small",3,"click"],["color","medium"]],template:function(e,i){e&1&&(s(0,"ion-header",1)(1,"ion-toolbar")(2,"ion-title"),c(3,"Lista de Alumnos"),a()()(),s(4,"ion-content",2)(5,"ion-header",3)(6,"ion-toolbar")(7,"ion-title",4),c(8,"Lista de Alumnos"),a()()(),s(9,"h2"),c(10),a(),s(11,"h3"),c(12),a(),s(13,"p"),c(14),a(),s(15,"ion-grid")(16,"ion-row")(17,"ion-col")(18,"strong"),c(19,"Alumno"),a()(),s(20,"ion-col")(21,"strong"),c(22,"Solicitud de asistencia"),a()(),s(23,"ion-col")(24,"strong"),c(25,"Acciones"),a()()(),w(26,_t,9,4,"ion-row",5),a()()),e&2&&(u("translucent",!0),l(4),u("fullscreen",!0),l(6),g("Grupo: ",i.grupoNombre,""),l(2),g("Materia: ",i.materiaNombre,""),l(2),g("Horario: ",i.horario,""),l(12),u("ngForOf",i.alumnos))},dependencies:[J,G,Q,W,q,U,B,R,V,L,O,D,K],encapsulation:2});let o=r;return o})();export{wt as ListaProfesorPage};
